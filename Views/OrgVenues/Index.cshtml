@model List<EventTicketingSystem.Controllers.VenueRow>
@{
    ViewData["Title"] = "My Venues";
    int page = (int)ViewBag.Page;
    int pageSize = (int)ViewBag.PageSize;
    int totalPages = (int)ViewBag.TotalPages;
    string? q = ViewBag.Q as string;
}
<div class="container py-4">
    @if (TempData["VenueMsg"] is string msg)
    {
        <div class="alert alert-info">@msg</div>
    }

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h4 mb-0">My Venues</h1>
        <a class="btn btn-dark" asp-action="Create">+ New Venue</a>
    </div>

    <form method="get" class="row g-2 mb-3">
        <div class="col-12 col-md-6">
            <input class="form-control" name="q" value="@q" placeholder="Search by name or location..." />
        </div>
        <div class="col-6 col-md-3">
            <select name="pageSize" class="form-select" onchange="this.form.submit()">
                @if (pageSize == 10)
                {
                    <option value="10" selected>10 per page</option>
                }
                else
                {
                    <option value="10">10 per page</option>
                }

                @if (pageSize == 20)
                {
                    <option value="20" selected>20 per page</option>
                }
                else
                {
                    <option value="20">20 per page</option>
                }
            </select>

        </div>
        <div class="col-6 col-md-3">
            <button class="btn btn-outline-secondary w-100" type="submit">Search</button>
        </div>
    </form>

    @if (Model.Count == 0)
    {
        <div class="alert alert-light border-0 shadow-sm">No venues yet.</div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table align-middle">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Location</th>
                        <th>Capacity</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var v in Model)
                    {
                        <tr>
                            <td>@v.Name</td>
                            <td>@v.Location</td>
                            <td>@v.Capacity</td>
                            <td class="text-end">
                                <a class="btn btn-sm btn-outline-primary" asp-action="Edit" asp-route-id="@v.VenueId">Edit</a>
                                <form method="post" asp-action="Delete" asp-route-id="@v.VenueId" class="d-inline"
                                    onsubmit="return confirm('Delete this venue?');">
                                    @Html.AntiForgeryToken()
                                    <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (totalPages > 1)
        {
            <nav>
                <ul class="pagination">
                    @{
                        var prev = page - 1; var next = page + 1; var qs = $"&q={q}&pageSize={pageSize}";
                    }
                    <li class="page-item @(page == 1 ? "disabled" : "")"><a class="page-link" href="?page=@prev@qs">Previous</a>
                    </li>
                    @for (int i = 1; i <= totalPages; i++)
                    {
                        <li class="page-item @(i == page ? "active" : "")"><a class="page-link" href="?page=@i@qs">@i</a></li>
                    }
                    <li class="page-item @(page == totalPages ? "disabled" : "")"><a class="page-link"
                            href="?page=@next@qs">Next</a>
                    </li>
                </ul>
            </nav>
        }
    }
</div>
