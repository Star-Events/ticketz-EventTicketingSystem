@model IEnumerable<EventTicketingSystem.Models.EventListItemVm>
@{
  ViewData["Title"] = "All Events";
  int page = (int)ViewBag.Page;
  int pageSize = (int)ViewBag.PageSize;
  int totalPages = (int)ViewBag.TotalPages;
  string? q = ViewBag.Q as string;
}

<section class="mb-4 mt-4">
  <h1 class="h3 mb-3">All Events</h1>
  <form method="get" class="row g-2">
    <div class="col-12 col-md-6">
      <input class="form-control" name="q" value="@q" placeholder="Search events..." />
    </div>
    <div class="col-6 col-md-3">
      <select name="pageSize" class="form-select" onchange="this.form.submit()">
        <option value="6" selected="@(pageSize == 6)">6 per page</option>
        <option value="8" selected="@(pageSize == 8)">8 per page</option>
        <option value="12" selected="@(pageSize == 12)">12 per page</option>
      </select>
    </div>
    <div class="col-6 col-md-3">
      <button class="btn btn-dark w-100" type="submit">Search</button>
    </div>
  </form>
</section>

<section class="row g-3">
  @foreach (var e in Model)
  {
    var card = new EventTicketingSystem.Models.EventCardVm
    {
      EventId = e.EventId,
      Title = e.Title,
      DateTime = e.When,
      Venue = e.Venue,
      Price = e.Price,
      Availability = e.Availability,
      Status = e.Status,
      Remaining = e.Remaining
    };

    <div class="col-12 col-md-6">
      @await Component.InvokeAsync("EventCard", new { model = card })
    </div>
  }
</section>

@if (totalPages > 1)
{
  <nav class="mt-4">
    <ul class="pagination">
      @{
        var prev = page - 1;
        var next = page + 1;
      }
      <li class="page-item @(page == 1 ? "disabled" : "")">
        <a class="page-link" href="?page=@prev&pageSize=@pageSize&q=@q">Previous</a>
      </li>
      @for (int i = 1; i <= totalPages; i++)
      {
        <li class="page-item @(i == page ? "active" : "")">
          <a class="page-link" href="?page=@i&pageSize=@pageSize&q=@q">@i</a>
        </li>
      }
      <li class="page-item @(page == totalPages ? "disabled" : "")">
        <a class="page-link" href="?page=@next&pageSize=@pageSize&q=@q">Next</a>
      </li>
    </ul>
  </nav>
}
