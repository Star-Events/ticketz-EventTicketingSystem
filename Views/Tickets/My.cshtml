@model EventTicketingSystem.Models.MyTicketsVm
@{
    ViewData["Title"] = "My Tickets";
    string StatusClass(string s) => s?.ToLower() switch
    {
        "live" => "success",
        "upcoming" => "secondary",
        "completed" => "dark",
        "cancelled" => "danger",
        _ => "secondary"
    };
}

<div class="container py-4">
    <h1 class="h4 mb-3">My Tickets</h1>

    @if (Model.Groups.Count == 0)
    {
        <div class="alert alert-light border-0 shadow-sm">No tickets yet.</div>
    }
    else
    {
        foreach (var g in Model.Groups)
        {
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="h5 mb-1">@g.EventTitle</div>
                            <div class="text-muted small mb-1">@g.StartsAt.ToString("ddd dd MMM yyyy, h:mm tt") â€” @g.Venue</div>
                            <span class="badge text-bg-@StatusClass(g.Status)">@g.Status</span>
                        </div>
                        <div class="text-end">
                            <div>Total: <strong>LKR @g.TotalAmount.ToString("N0")</strong></div>
                            <div class="small text-muted">Order: @g.BookingId</div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <div class="fw-semibold mb-2">Tickets (@g.Tickets.Count)</div>
                        <div class="row g-2">
                            @foreach (var t in g.Tickets)
                            {
                                <div class="col-12 col-md-6 col-lg-4">
                                    <div class="border rounded p-3 d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="small text-muted">Ticket</div>
                                            <div class="fw-semibold">#@t.ShortId</div>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <a class="btn btn-sm btn-outline-secondary" asp-controller="Tickets" asp-action="Qr"
                                                asp-route-ticketId="@t.TicketId" target="_blank">View QR</a>
                                            <a class="btn btn-sm btn-dark" asp-controller="Tickets" asp-action="Pdf"
                                                asp-route-ticketId="@t.TicketId">Download PDF</a>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>
