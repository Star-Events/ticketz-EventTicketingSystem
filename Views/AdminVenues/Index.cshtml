@model IEnumerable<EventTicketingSystem.Models.AdminVenueRow>
@{
    ViewData["Title"] = "Manage Venues";
    string? q = ViewBag.Search as string;
    int page = (int)ViewBag.Page;
    int pageSize = (int)ViewBag.PageSize;
    int totalPages = (int)ViewBag.TotalPages;
}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Manage Venues</h1>
    <a class="btn btn-dark" asp-controller="Admin" asp-action="Index">Back to Dashboard</a>
  </div>

  @if (TempData["AdminVenueMsg"] is string msg)
  {
    <div class="alert alert-info">@msg</div>
  }

  <form method="get" class="row g-2 mb-3">
    <div class="col-12 col-md-6">
      <input class="form-control" name="search" value="@q" placeholder="Search by name or address..." />
    </div>
    <div class="col-6 col-md-3">
      <select name="pageSize" class="form-select" onchange="this.form.submit()">
        <option value="10" selected="@(pageSize==10)">10 per page</option>
        <option value="20" selected="@(pageSize==20)">20 per page</option>
        <option value="50" selected="@(pageSize==50)">50 per page</option>
      </select>
    </div>
    <div class="col-6 col-md-3">
      <button class="btn btn-outline-secondary w-100" type="submit">Filter</button>
    </div>
  </form>

  <div class="card border-0 shadow-sm">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Address</th>
            <th>Capacity</th>
            <th>Status</th>
            <th>Owner</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
        @if (!Model.Any())
        {
          <tr><td colspan="6"><div class="alert alert-light border-0 mb-0">No venues found.</div></td></tr>
        }
        else
        {
          @foreach (var v in Model)
          {
            <tr>
              <td class="fw-semibold">@v.Name</td>
              <td class="text-muted">@v.Address</td>
              <td>@v.Capacity</td>
              <td>
                @if (v.IsActive)
                { <span class="badge text-bg-success">Active</span> }
                else
                { <span class="badge text-bg-secondary">Inactive</span> }
              </td>
              <td>@(string.IsNullOrWhiteSpace(v.OwnerName) ? "-" : v.OwnerName)</td>
              <td class="text-end">
                <div class="btn-group">
                  <a class="btn btn-sm btn-outline-secondary" asp-action="Edit" asp-route-id="@v.VenueId">Edit</a>
                  <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@v.VenueId">Delete</a>
                </div>
              </td>
            </tr>
          }
        }
        </tbody>
      </table>
    </div>
  </div>

  @if (totalPages > 1)
  {
    <nav class="mt-3">
      <ul class="pagination">
        @{
          var prev = page - 1;
          var next = page + 1;
        }
        <li class="page-item @(page==1?"disabled":"")">
          <a class="page-link" href="?page=@prev&pageSize=@pageSize&search=@q">Previous</a>
        </li>
        @for (int i=1;i<=totalPages;i++)
        {
          <li class="page-item @(i==page?"active":"")">
            <a class="page-link" href="?page=@i&pageSize=@pageSize&search=@q">@i</a>
          </li>
        }
        <li class="page-item @(page==totalPages?"disabled":"")">
          <a class="page-link" href="?page=@next&pageSize=@pageSize&search=@q">Next</a>
        </li>
      </ul>
    </nav>
  }
</div>
